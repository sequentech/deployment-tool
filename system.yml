---
- name: System, setting hostname
  sudo: true
  hostname: name={{ config.host }}

- name: System, private ip in /etc/hosts
  sudo: true
  lineinfile: dest=/etc/hosts line="{{ config.private_ipaddress }} {{ config.host }}" state=present

- name: System, domain in /etc/hosts
  sudo: true
  lineinfile: dest=/etc/hosts line="{{ config.private_ipaddress }} {{ config.agora_elections_domain }}" state=present

- name: System, Creating nginx group
  sudo: true
  group: name=nginx state=present

- name: System, Creating nginx user
  sudo: true
  user: name=nginx shell=/bin/false home=/nonexistent group=nginx

- name: System, cert directories creation
  sudo: true
  file: path=/srv/certs/selfsigned recurse=yes state=directory owner=root group=users

- name: System, self-signed certificate creation
  sudo: true
  template: src=templates/cert.sh
            dest=/root/cert.sh
            owner=root mode=0755

- name: System, self-signed certificate creation
  sudo: true
  shell: "/root/cert.sh"

- name: System, populating /etc/hosts
  sudo: true
  lineinfile: dest=/etc/hosts line="{{ item.ip }} {{ item.hostname }}" state=present
  with_items: config.hosts
